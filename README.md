# Superpixel-network
The repositpry contains programs related to superpixels, which was inspired by the paper "Superpixel guided medical image segmentation based on deep network".

## Implementation of deep learning framework -- Network, using Matlab,Keras

The architecture was inspired by **Superpixel guided medical image segmentation based on deep network**.

##Overview

### Data
[Provided data]
The data for training contains 1100 512*512 superpixel images, and their corresponding ground truths are manually labeled. you can also find data in the data folder for testing.

### Pre-processing
The images are 3-D volume tiff, you should transfer the images into ".npy" format.
The data for training contains 1100 512*512 images, and their corresponding ground truth is manually labeled.

### Model
The model of this neural network consists of three parts. The first part is the SLIC superpixel generation algorithm, and the second part is the BF module forthe bilateral filtering, which are implemented in matlab using opencv.The third part is our network.
Our deep neural network is implemented with Keras functional API, which makes it extremely easy to experiment with different interesting architectures.
Output from the network is a 512*512 which represents mask that should be learned.

### Training
The model is trained for 1000 epochs.
After 1000 epochs, calculated accuracy is about 0.94.

---
## How to use
---
### Dependencies
This tutorial depends on the following libraries:
* Tensorflow
* Keras >= 1.0
* libtiff(optional)

Also, this code should be compatible with Python versions 3.5 and Matlab.

### Prepare the data
First transfer 3D volume tiff to 512*512 images.
To feed the net, the first two steps need to be implemented first.
*Superpixels generated by SLIC
Run "main.c" to generate superpixels.
The SLIC code segments the image into 500 superpixels using a weighting factor of 10 relating spatial distances to colour distances, resulting superpixels of area less than 10 pixels are eliminated.
*Processing the superpixels by BF 
Run the same file to achieve bilateral filtering.
Customing sigma_d and sigma_r parameters of the bfltGray() function to produce the better results for further processing.

### Define the model
* Check out "create_net()" in "New_net.py" to modify the model, optimizer and loss function.

### Train the model and generate masks for test images
* Run "python New_net.py" to train the model.

After this script finishes, in "imgs_test_predict.npy" masks for corresponding images in "imgs_test.npy" should be generated.

### Results
Use the trained model to do segmentation on test images, the result is statisfactory.
